## ☀ 로드 밸런싱이란?

> 네트워크 또는 서버에 가해지는 로드(트래픽)를 분산해주는 기술
> 
- 중앙처리장치 혹의 저장장치와 같은 컴퓨터 자원들에게 작업을 나누는 것을 의미한다.
- 많은 양의 트래픽을 처리하기 위해 대부분의 애플리케이션에는 데이터가 중복되는 리소스 서버가 많이 있다.
- 로드 밸런서는 사용자와 서버 그룹 사이에 위치하며 보이지 않는 촉진자 역할을 하여 모든 리소스 서버가 동일하게 사용되도록 하는 장치이다.

<br>

## ☀ 로드 밸런싱의 필요성

로드 밸런싱은 여러 대의 서버를 두고 서비스를 제공하는 분산 처리 시스템에서 필요한 기술이다.

규모가 확장되며 증가하는 트래픽에 대처할 수 있는 방법은 크게 2가지이다.

![image](https://github.com/05AM/CS-Chanmi/assets/83827023/440ca531-f192-447d-a4dc-46e73849eacf)


1. `Scale-up` : 서버 자체의 성능을 확장하는 것. 
    - ex) CPU가 i3인 컴퓨터를 i7로 업그레이드하는 것
2. `Scale-out` : 기존 서버와 동일하거나 낮은 성능의 서버를 두 대 이상 증설하여 운영하는 것
    - ex) CPU가 i3인 컴퓨터를 여러 대 추가 구입해 운영하는 것
    
    ⇒ 이 경우, 여러 대의 서버로 트래픽을 균등하게 분산해주는 로드밸런싱이 필요하다.

<br>

## ☀ 로드 밸런서의 정의 (Load Balancer)

![image](https://github.com/05AM/CS-Chanmi/assets/83827023/d3e04025-65ec-4b5f-9cb6-7f1ab3b76a22)

- 로드 밸런싱 기술을 제공하는 서비스 또는 장치
- 클라이언트와 네트워크 트래픽이 집중되는 서버 그룹 또는 네트워크 허브 사이에 위치한다.

<br>

## ☀ 로드 밸런싱 알고리즘

로드 밸런싱 알고리즘은 로드 밸런서가 서로 다른 클라이언트 요청 각각에 가장 적합한 서버를 결정하기 위해 따르는 규칙 세트이다. 로드 밸런싱 알고리즘은 크게 2가지 범주로 나뉜다.

### 정적 로드 밸런싱

정적 로드 밸런싱 알고리즘은 고정된 규칙을 따르며 현재 서버 상태와 무관하다.

1. `라운드로빈 방식` (Round Robin Method)
    - 서버에 들어온 요청을 순서대로 돌아가며 배정하는 방식
    - 클라이언트의 요청을 순서대로 분배하기 때문에 여러 대의 서버가 동일한 스펙을 갖고 있다.
    - 서버와의 연결(세선)이 오래 지속되지 않는 경우에 활용하기 적합하다.
    - 예제
        
        서버에는 클라이언트에게 요청을 전송할 위치를 알려주는 IP 주소가 있습니다. IP 주소는 기억하기 어려운 긴 숫자입니다. 이를 쉽게 하기 위해 도메인 이름 시스템은 웹 사이트 이름을 서버에 매핑합니다. 브라우저에 [aws.amazon.com](https://aws.amazon.com/)을 입력하면 먼저 요청이 당사의 이름 서버로 전달되고 이름 서버는 IP 주소를 브라우저로 반환합니다.
        
        라운드 로빈 방식에서는 **권한 있는 이름 서버가 특수 하드웨어나 소프트웨어 대신 로드 밸런싱을 수행**합니다. 이름 서버는 서버 팜에 있는 여러 서버의 IP 주소를 차례대로 또는 라운드 로빈 방식으로 반환합니다.
        
2. `가증 라운드로빈 방식` ( Weighted Round Robin Method)
    - 우선순위 또는 용량에 따라 각 서버에 서로 다른 가중치를 할당하고, 가중치가 높은 서버에 클라이언트 요청을 우선적으로 배분한다.
    - 가중치가 높은 서버는 이름 서버에서 들어오는 애플리케이션 트래픽을 더 많이 수신합니다.
    - 주로 서버의 트래픽 처리 능력이 상이한 경우 사용되는 부하 분산 방식이다.
    - 예제
        
        A라는 서버가 5라는 가중치를 갖고 B라는 서버가 2라는 가중치를 갖는다면, 로드밸런서는 라운드로빈 방식으로 A 서버에 5개, B 서버에 2개의 요청을 전달한다.
        
3. `IP 해시 방식` (IP Hash Method)
    - 클라이언트의 IP 주소를 특정 서버로 매핑하여 요청을 처리하는 방식이다.
    - 사용자의 IP를 해싱(Hashing, 임의의 길이를 지닌 데이터를 고정된 길이의 데이터로 매핑하는 것)하여 로드를 분배하기 때문에 사용자가 항상 동일한 서버로 연결되는 것을 보장한다.

### 동적 로드 밸런싱

동적 로드 밸런싱 알고리즘은 트래픽을 배포하기 전에 서버의 현재 상태를 검사한다.

1. `최소 연결 방식` (Least Connection Method)
    - 요청이 들어온 시점에 가장 적은 연결 상태를 보이는 서버에 우선적으로 트래픽을 배분한다.
    - 자주 세션이 길어지거나, 서버에 분배된 트래픽들이 일정하지 않은 경우에 적합한 방식이다.
2. `가중치 기반 최소 연결 방법`
    - 가중치 기반 최소 연결 알고리즘은 일부 서버가 다른 서버보다 더 많은 활성 연결을 처리할 수 있다고 가정한다. 따라서 각 서버에 다른 가중치 또는 용량을 할당할 수 있으며 로드 밸런서는 용량별 연결이 가장 적은 서버로 새 클라이언트 요청을 전송한다.
3. `최소 리스폰타입` (Least Response Time Method)
    - 서버의 현재 연결 상태와 응답 시간(Response Time, 서버에 요청을 보내고 최초 응답을 받을 때까지 소요되는 시간)을 모두 고려하여 트래픽을 배분한다.
    - 가장 적은 연결 상태와 가장 짧은 응답 시간을 보이는 서버에 우선적으로 로드를 배분하는 방식이다.
4. `리소스 기반 방법`
    - 로드 밸런서는 현재 서버 부하를 분석하여 트래픽을 배포한다. 에이전트라고 하는 특수 소프트웨어는 각 서버에서 실행되며 컴퓨팅 용량 및 메모리와 같은 서버 리소스의 사용량을 계산한다.
    - 그런 다음 로드 밸런서는 해당 서버에 트래픽을 배포하기 전에 에이전트에 충분한 여유 리소스가 있는지 확인한다.

<br>

## ☀ 로드 밸런싱의 작동 방식

회사는 일반적으로 여러 서버에서 애플리케이션을 실행합니다. 이러한 서버 배열을 `서버 팜`이라고 한다. 애플리케이션에 대한 **사용자 요청은 먼저 로드 밸런서로 이동**한다. 그런 다음 **로드 밸런서는 요청을 처리하는 데 가장 적합한 서버 팜의 단일 서버로 각 요청을 라우팅**합니다.

로드 밸런싱은 레스토랑에서 관리자가 수행하는 작업과 같습니다. 5명의 웨이터가 있는 식당을 생각해 보세요. 고객이 웨이터를 선택할 수 있는 경우 한두 명의 웨이터는 업무에 과부하가 걸리고 나머지는 유휴 상태일 수 있습니다. 이러한 경우가 발생하지 않도록 레스토랑 관리자는 고객에게 가장 적합한 특정 웨이터에게 고객을 할당합니다.

![image](https://github.com/05AM/CS-Chanmi/assets/83827023/b60688e4-3cca-4cbf-8c52-330dbfa948a0)

<br>

## ☀ 로드 밸런서의 종류

네트워크 통신 세스템은 크게 일곱 가지의 계층(OSI 7 layers, 개방형 통신을 위한 국제 표준 모델)로 나뉜다. 각각의 계층(Layer)이 L1/L2/L3 … L7에 해당한다.

**상위 계층에서 사용되는 장비는 하위 계층의 장비가 갖고 있는 기능을 모두 가지고 있으며**, **상위 계층으로 갈수록 더욱 정교한 로드밸런싱이 가능**하다.

부하 분산에는 L4 로드 밸런서와 L7 로드 밸런서가 가장 많이 활용되는데, L4 로드 밸런서로부터 포트(Port) 정보를 바탕으로 로드를 분산하는 것이 가능하기 때문이다. 한 대의 서버에 각기 다른 포트 번호를 부여하여 다수의 서버 프로그램을 운영하는 경우라면 최소 L4 로드 밸런서 이상을 사용해야만 한다. 

### L4 Load Balancing

> 네트워크 계층(IP, IPX)이나 트랜스포트 계층(TCP, UDP)의 정보를 바탕으로 로드를 분산한다. IP 주소나 포트번호, MAC 주소, 전송 프로토콜에 따라 트래픽을 나누는 것이 가능하다.
> 

![image](https://github.com/05AM/CS-Chanmi/assets/83827023/4c47030c-ee1e-4295-a55c-4779e22e09af)

### L7 Load Balancing

> 애플리케이션 계층(HTTP, FTP, SMTP)에서 로드를 분산한다. HTTP 헤더, 쿠키 등과 같은 사용자의 요청을 기준으로 특정 서버에 트래픽을 분산하는 것이 가능하다.
> 
- 즉, 패킷의 내용을 확인하고 그 내용에 따라 로드를 특정 서버에 분배하는 것이 가능하다.

![image](https://github.com/05AM/CS-Chanmi/assets/83827023/e8c90595-78e9-4ae6-8b0a-8210f3e18e26)

- 위 그림과 같이 URL에 따라 부하들을 분산시키거나, HTTP 헤더의 쿠키값에 따라 부하를 분산하는 등 클라이언트의 요청을 보다 세분화해 서버에 전달할 수 있다.
- 또한 L7 로드밸런서의 경우 특정한 패턴을 지닌 바이러스르 감지해 네트워크를 보호할 수 있으며, DoS/DDoS와 같은 비정상적인 트래픽을 필터링할 수 있어 네트워크 보안 분야에서도 활용되고 있다.

### L4 로드밸런서 vs L7 로드밸런서

![image](https://github.com/05AM/CS-Chanmi/assets/83827023/d66b185b-a9fd-41d3-8a70-e4833d8a7c83)

<br>

## ☀ 로드 밸런싱의 유형

### 애플리케이션 로드 밸런싱

복잡한 최신 애플리케이션에는 단일 애플리케이션 기능을 전담하는 여러 서버를 포함하는 여러 **서버 팜**이 있습니다. Application Load Balancer는 **HTTP 헤더 또는 SSL 세션 ID와 같은 요청 콘텐츠를 확인하여 트래픽을 리다이렉션**한다.

예를 들어, 전자 상거래 애플리케이션에는 제품 디렉터리, 장바구니 및 결제 기능이 있습니다. Application Load Balancer는 이미지와 비디오를 포함하지만 열린 연결을 유지할 필요가 없는 서버에 제품 검색 요청을 전송합니다. 이에 비해 많은 클라이언트 연결을 유지하고 장바구니 데이터를 오랫동안 저장할 수 있는 서버로 장바구니 요청을 전송합니다.

### 네트워크 로드 밸런싱

Network Load Balancer는 **IP 주소 및 기타 네트워크 정보를 검사하여 트래픽을 최적으로 리다이렉션한다**.

애플리케이션 트래픽의 소스를 추적하고 여러 서버에 고정 IP 주소를 할당할 수 있다. Network Load Balancer는 앞에서 설명한 정적 및 동적 로드 밸런싱 알고리즘을 사용하여 서버 로드를 배포한다.

### 글로벌 서버 로드 밸런싱

글로벌 서버 로드 밸런싱은 **지리적으로 분산된 여러 서버에서 발생한다**.

예를 들어, 회사는 여러 데이터 센터, 여러 국가 및 전 세계의 타사 클라우드 제공업체에 서버를 둘 수 있다. 이 경우 로컬 로드 밸런서는 리전 또는 영역 내에서 애플리케이션 로드를 관리한다. 그리고 클라이언트와 지리적으로 더 가까운 서버 대상으로 트래픽을 리디렉션하려고 한다. 서버 장애가 발생한 경우에만 클라이언트의 지리적 영역 외부의 서버로 트래픽을 리다이렉션 할 수 있다.

### DNS 로드 밸런싱

DNS 로드 밸런싱에서는 **도메인의 리소스 풀에서 네트워크 요청을 라우팅하도록 도메인을 구성**한다.

도메인은 웹 사이트, 메일 시스템, 인쇄 서버 또는 인터넷을 통해 액세스할 수 있는 다른 서비스에 해당할 수 있다. DNS 로드 밸런싱은 애플리케이션 가용성을 유지하고 전역적으로 분산된 리소스 풀에서 네트워크 트래픽을 분산하는 데 유용하다.

## ☀ 로드 밸런싱의 이점

로드 밸런싱은 애플리케이션 서버와 방문자 또는 클라이언트 간의 인터넷 트래픽을 지시하고, 제어한다. 결과적으로 애플리케이션의 가용성, 확장성, 보안 및 성능이 향상된다.

### 애플리케이션 가용성

- 서버 장애 또는 유지 관리로 인해 애플리케이션 가동 중지 시간이 늘어 방문자가 애플리케이션을 사용할 수 없게 되는 등 **서버에 문제가 생길 경우**, 로드 밸런서는 문제를 자동으로 감지하고 클라이언트 트래픽을 사용 가능한 서버로 리다이렉션하여 시스템의 내결함성을 높인다.
- 로드 밸런서를 사용하여 다음 작업들을 더 쉽게 수행할 수 있다.
    - 애플리케이션 가동 중지 없이 애플리케이션 서버 유지 관리 또는 업그레이드 실행
    - 백업 사이트에 자동 재해 복구 제동
    - 상태 확인을 수행하고 가동 중지를 유발할 수 있는 문제 방지

### 애플리케이션 확장성

- 로드 밸런서를 사용하여 **여러 서버 간에 네트워크 트래픽을 지능적으로 전달**할 수 있다. 로드 밸런싱이 다음을 수행하므로 애플리케이션에서 수천 개의 클라이언트 요청을 처리할 수 있다.
    - 한 서버에서 트래픽 병목 현상 방지
    - 필요한 경우 다른 서버를 추가하거나 제거할 수 있도록 애플리케이션 트래픽을 예측한다.
    - 안심하고 조정할 수 있도록 시스템에 중복성을 추가한다.

### 애플리케이션 보안

- 로드 밸런서에는 인터넷 애플리케이션에 **또 다른 보안 계층을 추가할 수 있는 보안 기능이 내장**되어 있다. 이는 공격자가 서버 장애를 일으키는 수백만 개의 동시 요청으로 애플리케이션 서버를 가득 채우는 분산 서비스 거부 공격을 처리하는데 유용한 도구이다.
    - 트래픽 모니터링 및 악성 콘텐츠 차단
    - 공격 트래픽을 여러 백엔드 서버로 자동으로 리다이렉션하여 영향 최소화
    - 추가 보안을 위해 네트워크 방화벽 그룹을 통해 트래픽 라우팅

### 애플리케이션 성능

- 로드 밸런서는 **응답 시간을 늘리고 네트워크 지연 시간을 줄여 애플리케이션 성능을 향상**시킨다.
    - 서버 간의 로드를 균등하게 배포하여 애플리케이션 성능 향상
    - 클라이언트 요청을 지리적으로 더 가까운 서버로 리다이렉션하여 지연 시간 단축
    - 물리적 및 가상 컴퓨팅 리소스의 신뢰성 및 성능 보장

<br>

## ☀ 참고 자료

[로드밸런서(Load Balancer)의 개념과 특징](https://m.post.naver.com/viewer/postView.naver?volumeNo=27046347&memberNo=2521903)

[로드 밸런싱이란 무엇인가요? - 로드 밸런싱 알고리즘 설명 - AWS](https://aws.amazon.com/ko/what-is/load-balancing/)
